openapi: 3.0.0
info:
  version: v1.0
  title: Consent Management API
  description: |
    This API provides a comprehensive set of endpoints for managing consents and consent purposes.
    
    **Consent Management**: Handles the entire consent lifecycle, from initiation and authorization 
    to validation, administration, and revocation.
    
    **Consent Purpose Management**: Manages consent purposes as reference data that can be used to 
    categorize and define the intended use of consents (e.g., "Account Information Access", 
    "Payment Initiation", "Marketing", etc.).
  contact:
    name: WSO2
    url: 'https://wso2.com/solutions/financial-services/'
    email: "architecture@wso2.com"
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
servers:
  - url: https://{km_host}:{km_port}/api/v1
    variables:
      km_host:
        default: localhost
        description: Hostname of the Consent Management server.
      km_port:
        default: "3000"
        description: Port number for the Consent Management server.
tags:
  - name: Consent
    description: Provides RESTful endpoints to handle the full lifecycle of consent resources, their associated authorizations, and attached files. Supports operations such as initiation, retrieval, update, and revocation.
  - name: Consent Purpose
    description: Manage consent purposes (reference data for categorizing consents). Purposes can be created, retrieved, updated, deleted, and validated.
paths:
  /consents:
    post:
      summary: Initiate a new consent resource
      description: |
        This endpoint is used to initiate a new consent resource.  

        In order to handle custom requirements, The endpoint invokes the following **extension points**:
        - **/pre-process-consent-creation**: to verify inputs according to the regulation requirements and obtain the mapping of consent data to store.
        - **/enrich-consent-creation-response**: to handle response construction, additional validations, and any custom processing after consent creation.
        
        Upon success, the system creates a **consent resource** with: A unique `consentId`  
      operationId: consents-POST
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "The unique identifier for the organization (e.g., the bank) that this consent belongs to."
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "The client ID of the Third-Party Provider (TPP) application that is requesting the consent."
          schema:
            type: string
      requestBody:
        description: The payload containing the consent data.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConsentCreatePayload"
      responses:
        "201":
          description: Successfully initiated the consent. The response body contains the details of the newly created consent resource, including its `consentID`.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentCreatedResponse"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to create the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
    get:
      summary: Search for consents
      description: |
        Provides a powerful search capability to find consents based on various filter criteria like consent type, status, client ID , user ID and time range. Supports pagination.
      
      operationId: consents-search-GET
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - name: consentTypes
          in: query
          description: A comma-separated list of consent types to filter by (e.g., 'accounts,payments').
          schema:
            type: string
        - name: consentStatuses
          in: query
          description: A comma-separated list of consent statuses to filter by (e.g., 'authorised,revoked').
          schema:
            type: string
        - name: clientIds
          in: query
          description: A comma-separated list of TPP client IDs to filter by.
          schema:
            type: string
        - name: userIds
          in: query
          description: A comma-separated list of end-user IDs to filter by.
          schema:
            type: string
        - name: fromTime
          in: query
          description: The start of the time window for the search, as a Unix timestamp (integer).
          schema:
            type: integer
            format: int32
        - name: toTime
          in: query
          description: The end of the time window for the search, as a Unix timestamp (integer).
          schema:
            type: integer
            format: int32
        - name: withConsentFile
          in: query
          description: "Optional flag to retrieve the consent file along with the consent details."
          schema:
            type: boolean
        - name: limit
          in: query
          description: The maximum number of results to return in a single page. Used for pagination.
          schema:
            type: integer
            format: int32
        - name: offset
          in: query
          description: The number of results to skip. Used for pagination.
          schema:
            type: integer
            format: int32
      responses:
        "200":
          description: OK. Returns a list of consents matching the search criteria, along with pagination metadata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentSearchResponse"
        "400":
          description: Bad Request. The search parameters provided are invalid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
  /consents/attributes:
    get:
      summary: Search consents by attribute key and value
      description: |
        Searches for consent IDs that have a specific attribute key, optionally filtered by value.
        
        **Search Modes:**
        - **By key only** (`?key=department`): Returns all consents with the specified attribute key
        - **By key and value** (`?key=department&value=sales`): Returns consents with exact key-value match
        
        Results are organization-scoped and sorted by consent ID.
      operationId: consents-attributes-GET
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "The unique identifier for the organization."
          schema:
            type: string
        - in: header
          name: client-id
          required: true
          description: "The client ID of the application making the request."
          schema:
            type: string
        - name: key
          in: query
          required: true
          description: The attribute key to search for (required).
          schema:
            type: string
          example: "department"
        - name: value
          in: query
          required: false
          description: The attribute value to search for (optional). If provided, only consents with exact key-value match are returned.
          schema:
            type: string
          example: "sales"
      responses:
        "200":
          description: Successfully retrieved consent IDs matching the search criteria.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentAttributeSearchResponse"
        "400":
          description: Bad Request. The key parameter is missing or invalid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
  /consents/{consentId}:
    get:
      summary: Retrieve a consent by its ID
      description: |
        Fetches the complete details of a specific consent resource using
        its unique `consentID`. This is used to check the status and details of a consent.

        In order to handle requirements, The endpoint invokes following **extension point**:
        - **/pre-process-consent-retrieval**: handle pre-consent retrieval validations and to return a custom response payload.

      operationId: consents-GET
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "The unique identifier for the organization (e.g., the bank) that this consent belongs to."
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "The client ID of the Third-Party Provider (TPP) application that owns the consent."
          schema:
            type: string
        - name: withConsentFile
          in: query
          description: "Optional flag to retrieve the consent file along with the consent details."
          schema:
            type: boolean
        - in: path
          name: consentId
          required: true
          description: The unique identifier of the consent to retrieve.
          schema:
            type: string
      responses:
        "200":
          description: OK. The full details of the requested consent are returned in the response body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentRetrievalResponse"
        "400":
          description: Bad Request. The request was invalid, possibly due to a malformed `consentID` or missing headers.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
    put:
      tags:
        - Consent
      summary: Update a consent resource by its ID
      description: |
        Endpoint to perform a full update on a consent resource, including its authorization resources and attributes, in a single operation.

        In order to handle custom requirements, The endpoint invokes the following **extension points**:
        
        - **/pre-process-consent-update**: to verify inputs according to the regulation requirements and obtain the mapping of consent data to store.
        - **/enrich-consent-update-response**: to handle response construction, additional validations, and any custom processing after consent update.
      operationId: consents-PUT
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "The client ID of the Third-Party Provider (TPP) application that is requesting the consent."
          schema:
            type: string
        - name: consentId
          in: path
          description: The unique identifier of the consent to update.
          required: true
          schema:
            type: string
      requestBody:
        description: The full consent resource object with the desired updates.
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/ConsentUpdateRequest"
        required: true
      responses:
        "200":
          description: OK. The full details of the requested consent are returned in the response body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentUpdateResponse"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to update the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
  /consents/{consentId}/revoke:
    put:
      summary: Revoke a consent
      description: |
       Allows to revoke a consent. This action typically updates the consent status to a **revoke** type of status.
       
       In order to handle pre-consent revocation validations, The endpoint invokes the following **extension point**:
        - **/pre-process-consent-revoke**
      operationId: consents-revoke-POST
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "The unique identifier for the organization (e.g., the bank) that this consent belongs to."
          schema:
            type: string
        - name: consentId
          in: path
          description: The unique identifier of the consent to update.
          required: true
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "The client ID of the Third-Party Provider (TPP) application that is requesting the consent."
          schema:
            type: string
      requestBody:
        description: The payload containing the revocation data.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConsentRevokePayload"
      responses:
        "200":
          description: Successfully revoked the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentRevokedResponse"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to create the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
  /consents/{consentId}/file:
    post:
      summary: Upload a consent-related file
      description: |
        Uploads and associates a file with an existing consent.

        In order to handle custom requirements, The endpoint invokes the following **extension points**:
        
        - **/pre-process-consent-file-upload**: Handle pre validations related to file upload requests.
        - **/enrich-consent-file-response**: Modify the response sent in the file upload request after successfully storig the file.
      operationId: consents-file-POST
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "TPP Application client Id."
          schema:
            type: string
        - in: path
          name: consentId
          required: true
          description: The unique identifier of the consent to associate the file with.
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                resourceFile:
                  type: object
                  format: binary
                  description: This represents the corresponding resource file that needs to be added.
      responses:
        "201":
          description: Created. The file was successfully uploaded and associated with the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentFileUploadResponse"
        "400":
          description: Bad Request. Required parameters are unavailable.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
    get:
      summary: Download a consent-related file
      description: |
        Retrieves a file that has been associated with a specific consent.
        
        The response body expected to contain the consent file. In order to handle custom validations, The endpoint invokes following **extension point**:
        - **/validate-consent-file-retrieval**: Handle validations related to file retrieval and return a response
      operationId: consents-file-GET
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "TPP Application client Id."
          schema:
            type: string
        - in: path
          name: consentId
          required: true
          description: The unique identifier of the consent associated with the file.
          schema:
            type: string
      responses:
        "200":
          description: OK. The file content is returned in the response body.
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/File"
        "400":
          description: Bad Request. Required parameters are unavailable or invalid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
    put:
      summary: Update a consent-related file
      description: |
        Updates a file that has been associated with a specific consent.

        In order to handle custom requirements, The endpoint invokes the following **extension points**:
        
        - **/pre-process-consent-file-update**: Handle pre validations related to file update requests.
        - **/enrich-consent-file-update-response**: Modify the response sent in the file update request after successfully storig the updated file.
      operationId: consent-file-PUT
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - in: header
          name: TPP-client-id
          required: true
          description: "TPP Application client Id."
          schema:
            type: string
        - in: path
          name: consentId
          required: true
          description: The unique identifier of the consent to associate the file with.
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                resourceFile:
                  type: object
                  format: binary
                  description: This represents the corresponding resource file that needs to be added.
      responses:
        "201":
          description: Created. The file was successfully uploaded and associated with the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentFileUpdateResponse"
        "400":
          description: Bad Request. Required parameters are unavailable.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
      security:
        - basicAuth: []
  /consents/{consentId}/authorizations:
    post:
      tags:
        - Consent
      summary: Add an authorization resource to a consent
      description: Creates a new authorization resource and links it to the specified consent. This is typically done when a user interacts with the consent (e.g., at the start of the authorization flow).
      operationId: consents-authorizations-POST
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - name: consentId
          in: path
          description: The unique identifier of the consent.
          required: true
          schema:
            type: string
      requestBody:
        description: Details of the authorization resource to be created.
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/AuthorizationResourceRequestBody"
        required: true
      responses:
        '200':
          description: OK. Returns the details of the authorization resource.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ConsentAuthorizationResource"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to create the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon" 
      security:
        - basicAuth: []
    get:
      tags:
        - Consent
      summary: Retrieve all authorization resources for a consent
      description: Retrieves a list of all authorization resources associated with a specific consent.
      operationId: consentAuthorizationGet
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - name: consentId
          in: path
          description: The unique identifier of the consent.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK. Returns an array of authorization resources.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ConsentAuthorizationResource"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to create the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"  
      security:
        - basicAuth: []
  /consents/{consentId}/authorizations/{authorizationId}:
    get:
      tags:
        - Consent
      summary: Retrieve a specific authorization resource
      description: Retrieves the details of a specific authorization resource linked to a given consent.
      operationId: consentAuthorizationIdGet
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - name: consentId
          in: path
          description: The unique identifier of the consent.
          required: true
          schema:
            type: string
        - name: authorizationId
          in: path
          description: The unique identifier of the authorization resource.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK. Returns the details of the authorization resource.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ConsentAuthorizationResource"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to create the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon" 
      security:
        - basicAuth: []
    put:
      tags:
        - Consent
      summary: Update an authorization resource
      description: Updates the details (e.g., status) of a specific authorization resource associated with the given consent.
      operationId: consentAuthorizationIdPut
      parameters:
        - in: header
          name: org-id
          required: true
          description: "Organisation ID."
          schema:
            type: string
        - name: consentId
          in: path
          description: The unique identifier of the consent.
          required: true
          schema:
            type: string
        - name: authorizationId
          in: path
          description: The unique identifier of the authorization resource to update.
          required: true
          schema:
            type: string
      requestBody:
        description: The updated details for the authorization resource.
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/AuthorizationResourceRequestBody"
        required: true
      responses:
        '200':
          description: OK. Returns the details of the authorization resource.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ConsentAuthorizationResource"
        "400":
          description: Bad Request. The request was malformed. This could be due to missing required headers or an invalid request body.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon"
        "500":
          description: Internal Server Error. An unexpected error occurred on the server while trying to create the consent.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentErrorCommon" 
      security:
        - basicAuth: []
  /consent-purposes:
    post:
      summary: Create one or more consent purposes
      description: |
        Creates one or more consent purposes in a single request. Supports batch creation by accepting 
        an array of purpose definitions.
        
        **Type Handlers:**
        Each purpose has a type that determines which attributes are mandatory:
        - **string**: No mandatory attributes (any attributes are optional)
        - **json-schema**: Requires `validationSchema` attribute
        - **attribute**: Requires both `resourcePath` and `jsonPath` attributes
        
        **Transactional Behavior:**
        Batch creation is atomic - either all purposes in the request are created successfully, or none 
        are created. If any validation fails (e.g., duplicate name, invalid type, missing required attribute), 
        the entire batch is rolled back and no purposes are persisted to the database.
        
        **Validation Rules:**
        - Name is required and must not exceed 255 characters
        - Name must be unique within the organization (checked against existing purposes and within the batch)
        - Type is required and must be one of: `string`, `json-schema`, `attribute`
        - Attributes validation depends on type (see Type Handlers above)
        - Description is optional but must not exceed 1024 characters if provided
        - At least one purpose must be provided in the request array
        - Duplicate names within the same batch are not allowed
      operationId: createConsentPurposes
      tags:
        - Consent Purpose
      parameters:
        - in: header
          name: org-id
          required: true
          description: The unique identifier for the organization that owns these purposes
          schema:
            type: string
            example: "ORG-123"
        - in: header
          name: client-id
          required: false
          description: The client ID of the application making the request (for audit purposes)
          schema:
            type: string
            example: "CLIENT-456"
      requestBody:
        description: Array of consent purposes to create
        required: true
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              items:
                $ref: "#/components/schemas/ConsentPurposeCreateRequest"
            examples:
              stringType:
                summary: String type with optional attributes
                value:
                  - name: "license_read"
                    description: "Allows accessing license API"
                    type: "string"
                    attributes:
                      value: "license:read"
              stringTypeNoAttributes:
                summary: String type without attributes (valid)
                value:
                  - name: "basic_access"
                    type: "string"
              jsonSchemaType:
                summary: JSON Schema type with validationSchema
                value:
                  - name: "account_schema"
                    description: "Account access schema validation"
                    type: "json-schema"
                    attributes:
                      validationSchema: |
                        {
                          "type": "object",
                          "properties": {
                            "accountId": {"type": "string"},
                            "permissions": {"type": "array", "items": {"type": "string"}}
                          },
                          "required": ["accountId"]
                        }
              attributeType:
                summary: Attribute type with resource and json paths
                value:
                  - name: "user_permissions"
                    description: "Dynamic user permissions from API"
                    type: "attribute"
                    attributes:
                      resourcePath: "/api/v1/users"
                      jsonPath: "$.permissions.scopes"
              multiplePurposes:
                summary: Create multiple purposes with different types
                value:
                  - name: "license_read"
                    type: "string"
                    attributes:
                      value: "license:read"
                  - name: "tax_schema"
                    type: "json-schema"
                    attributes:
                      validationSchema: '{"type":"object"}'
                  - name: "dynamic_roles"
                    type: "attribute"
                    attributes:
                      resourcePath: "/api/roles"
                      jsonPath: "$.data.roles"
      responses:
        "201":
          description: Successfully created consent purpose(s)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ConsentPurposeResponse"
                  message:
                    type: string
                    example: "Consent purposes created successfully"
              examples:
                stringType:
                  summary: String type purpose created
                  value:
                    data:
                      - id: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        name: "license_read"
                        description: "Allows accessing license API"
                        type: "string"
                        attributes:
                          value: "license:read"
                    message: "Consent purposes created successfully"
                jsonSchemaType:
                  summary: JSON Schema type purpose created
                  value:
                    data:
                      - id: "PURPOSE-b2c3d4e5-f6a7-8901-bcde-f12345678901"
                        name: "account_schema"
                        description: "Account access schema validation"
                        type: "json-schema"
                        attributes:
                          validationSchema: '{"type":"object","properties":{"accountId":{"type":"string"}}}'
                    message: "Consent purposes created successfully"
                attributeType:
                  summary: Attribute type purpose created
                  value:
                    data:
                      - id: "PURPOSE-c3d4e5f6-a7b8-9012-cdef-123456789012"
                        name: "user_permissions"
                        description: "Dynamic user permissions from API"
                        type: "attribute"
                        attributes:
                          resourcePath: "/api/v1/users"
                          jsonPath: "$.permissions.scopes"
                    message: "Consent purposes created successfully"
        "400":
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                emptyArray:
                  summary: Empty array provided
                  value:
                    code: "BAD_REQUEST"
                    message: "Empty request"
                    details: "At least one purpose must be provided"
                missingName:
                  summary: Missing required name field
                  value:
                    code: "BAD_REQUEST"
                    message: "Invalid request body"
                    details: "Key: 'ConsentPurposeCreateRequest.Name' Error:Field validation for 'Name' failed on the 'required' tag"
                invalidType:
                  summary: Invalid type value
                  value:
                    error: "attribute_validation_failed"
                    message: "invalid purpose type 'invalid-type': must be one of [string, json-schema, attribute]"
                    type: "attribute_validation_error"
                jsonSchemaMissingValidationSchema:
                  summary: JSON Schema type missing validationSchema attribute
                  value:
                    error: "Validation failed"
                    message: "attribute validation failed: validationSchema is required for json-schema type"
                    type: "attribute_validation_error"
                attributeMissingResourcePath:
                  summary: Attribute type missing resourcePath
                  value:
                    error: "Validation failed"
                    message: "attribute validation failed: resourcePath is required for attribute type"
                    type: "attribute_validation_error"
                attributeMissingJsonPath:
                  summary: Attribute type missing jsonPath
                  value:
                    error: "Validation failed"
                    message: "attribute validation failed: jsonPath is required for attribute type"
                    type: "attribute_validation_error"
                duplicateName:
                  summary: Purpose name already exists
                  value:
                    code: "BAD_REQUEST"
                    message: "Invalid request"
                    details: "purpose name 'readAccountBasic' already exists for this organization"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
        - basicAuth: []
    get:
      summary: List all consent purposes
      description: |
        Retrieves a paginated list of all consent purposes for the specified organization.
        
        Results are ordered alphabetically by purpose name by default. Use the `limit` and `offset` 
        query parameters to control pagination.
      operationId: listConsentPurposes
      tags:
        - Consent Purpose
      parameters:
        - in: header
          name: org-id
          required: true
          description: The unique identifier for the organization
          schema:
            type: string
            example: "ORG-123"
        - name: limit
          in: query
          description: Maximum number of purposes to return (default 100, max 100)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
            example: 10
        - name: offset
          in: query
          description: Number of purposes to skip for pagination (default 0)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
            example: 0
      responses:
        "200":
          description: Successfully retrieved consent purposes
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentPurposeListResponse"
              example:
                purposes:
                  - id: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    name: "Marketing"
                    description: "Purpose for marketing and promotional communications"
                    type: "string"
                    value: "marketing:communications"
                  - id: "PURPOSE-b2c3d4e5-f6a7-8901-bcde-f12345678901"
                    name: "readAccountBasic"
                    description: "Allows reading basic account information"
                    type: "string"
                    value: "account:read:basic"
                  - id: "PURPOSE-c3d4e5f6-a7b8-9012-cdef-123456789012"
                    name: "readTransactions"
                    description: "Allows reading transaction history"
                    type: "string"
                    value: "account:read:transactions"
                total: 3
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
        - basicAuth: []
  /consent-purposes/validate:
    post:
      summary: Validate consent purpose names
      description: |
        Validates a list of consent purpose names and returns only the valid ones that exist in the database.
        
        This endpoint is useful for:
        - Validating purpose names before creating consents
        - Filtering out invalid purposes from a list
        - Checking which purposes are available in the organization
        
        **Behavior:**
        - Accepts an array of purpose names
        - Returns an array of names that exist in the organization
        - If none of the provided names are valid, returns 400 Bad Request
        - Names are case-sensitive and must match exactly
        - Empty request array returns 400 Bad Request
        
        **Response:**
        - **200 OK**: Returns array of valid purpose names (subset of input)
        - **400 Bad Request**: When request is empty or no valid purposes found
      operationId: validateConsentPurposes
      tags:
        - Consent Purpose
      parameters:
        - in: header
          name: org-id
          required: true
          description: The unique identifier for the organization
          schema:
            type: string
            example: "ORG-123"
      requestBody:
        description: Array of purpose names to validate
        required: true
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              items:
                type: string
              example:
                - "utility_read"
                - "taxes_read"
                - "profile_read"
            examples:
              allValid:
                summary: All purposes are valid
                value:
                  - "utility_read"
                  - "taxes_read"
              partialValid:
                summary: Some valid, some invalid
                value:
                  - "utility_read"
                  - "invalid_purpose"
                  - "taxes_read"
      responses:
        "200":
          description: Successfully validated purposes (returns only valid ones)
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
              examples:
                allValid:
                  summary: All provided purposes were valid
                  value:
                    - "utility_read"
                    - "taxes_read"
                partialValid:
                  summary: Only valid purposes returned
                  value:
                    - "utility_read"
                    - "taxes_read"
        "400":
          description: Bad Request - Empty request or no valid purposes found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                emptyRequest:
                  summary: Empty request array
                  value:
                    code: "BAD_REQUEST"
                    message: "Invalid request"
                    details: "at least one purpose name must be provided"
                noValidPurposes:
                  summary: No valid purposes found
                  value:
                    code: "BAD_REQUEST"
                    message: "Invalid request"
                    details: "no valid purposes found"
                missingOrgId:
                  summary: Missing org-id header
                  value:
                    code: "BAD_REQUEST"
                    message: "Invalid request"
                    details: "org-id header is required"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
        - basicAuth: []
  /consent-purposes/{purposeId}:
    get:
      summary: Get a specific consent purpose
      description: Retrieves the details of a specific consent purpose by its ID
      operationId: getConsentPurpose
      tags:
        - Consent Purpose
      parameters:
        - in: header
          name: org-id
          required: true
          description: The unique identifier for the organization
          schema:
            type: string
            example: "ORG-123"
        - name: purposeId
          in: path
          required: true
          description: The unique identifier of the consent purpose
          schema:
            type: string
            example: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      responses:
        "200":
          description: Successfully retrieved consent purpose
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentPurposeResponse"
              example:
                id: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                name: "readAccountBasic"
                description: "Allows reading basic account information"
                type: "string"
                attributes:
                  value: "account:read:basic"
        "404":
          description: Consent purpose not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                code: "NOT_FOUND"
                message: "Consent purpose not found"
                details: ""
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
        - basicAuth: []
    put:
      summary: Update a consent purpose
      description: |
        Updates an existing consent purpose. **All fields are required** - partial updates are not supported.
        
        **Type Handlers:**
        Each purpose type has specific attribute requirements that must be met:
        - **string**: No mandatory attributes (any attributes are optional)
        - **json-schema**: Requires `validationSchema` attribute
        - **attribute**: Requires both `resourcePath` and `jsonPath` attributes
        
        **Update Behavior:**
        - All fields (name, description, type, attributes) must be provided in the request
        - The purpose type can be changed, but new type's attribute requirements must be satisfied
        - Name must remain unique within the organization (or be the same as current name)
        - The update is transactional - either all fields are updated or none
        
        **Validation Rules:**
        - Name is required and must not exceed 255 characters
        - Name must be unique within the organization (excluding the current purpose)
        - Type is required and must be one of: `string`, `json-schema`, `attribute`
        - Attributes validation depends on type (see Type Handlers above)
        - Description is optional but must not exceed 1024 characters if provided
      operationId: updateConsentPurpose
      tags:
        - Consent Purpose
      parameters:
        - in: header
          name: org-id
          required: true
          description: The unique identifier for the organization
          schema:
            type: string
            example: "ORG-123"
        - name: purposeId
          in: path
          required: true
          description: The unique identifier of the consent purpose to update
          schema:
            type: string
            example: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      requestBody:
        description: Complete purpose data (all fields required - no partial updates)
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConsentPurposeUpdateRequest"
            examples:
              updateToString:
                summary: Update to string type (no mandatory attributes)
                value:
                  name: "license_read_updated"
                  description: "Updated license access permission"
                  type: "string"
                  attributes:
                    value: "license:read:v2"
              updateToJsonSchema:
                summary: Update to JSON Schema type (requires validationSchema)
                value:
                  name: "account_schema_v2"
                  description: "Updated account schema validation"
                  type: "json-schema"
                  attributes:
                    validationSchema: |
                      {
                        "type": "object",
                        "properties": {
                          "accountId": {"type": "string"},
                          "permissions": {"type": "array"}
                        },
                        "required": ["accountId"]
                      }
              updateToAttribute:
                summary: Update to Attribute type (requires resourcePath and jsonPath)
                value:
                  name: "user_roles_v2"
                  description: "Updated dynamic user roles"
                  type: "attribute"
                  attributes:
                    resourcePath: "/api/v2/users"
                    jsonPath: "$.data.roles"
                    validationSchema: '{"type":"array"}'
      responses:
        "200":
          description: Successfully updated consent purpose
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentPurposeResponse"
              examples:
                stringType:
                  summary: Updated to string type
                  value:
                    id: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    name: "license_read_updated"
                    description: "Updated license access permission"
                    type: "string"
                    attributes:
                      value: "license:read:v2"
                jsonSchemaType:
                  summary: Updated to JSON Schema type
                  value:
                    id: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    name: "account_schema_v2"
                    description: "Updated account schema validation"
                    type: "json-schema"
                    attributes:
                      validationSchema: '{"type":"object","properties":{"accountId":{"type":"string"}}}'
                attributeType:
                  summary: Updated to Attribute type
                  value:
                    id: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    name: "user_roles_v2"
                    description: "Updated dynamic user roles"
                    type: "attribute"
                    attributes:
                      resourcePath: "/api/v2/users"
                      jsonPath: "$.data.roles"
                      validationSchema: '{"type":"array"}'
        "400":
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingName:
                  summary: Missing required field (name)
                  value:
                    code: "INVALID_REQUEST"
                    message: "Invalid request"
                    details: "purpose name is required"
                invalidType:
                  summary: Invalid type value
                  value:
                    error: "attribute_validation_failed"
                    message: "invalid purpose type 'unknown': must be one of [string, json-schema, attribute]"
                    type: "attribute_validation_error"
                jsonSchemaMissingValidationSchema:
                  summary: JSON Schema type missing validationSchema
                  value:
                    error: "Validation failed"
                    message: "attribute validation failed: validationSchema is required for json-schema type"
                    type: "attribute_validation_error"
                attributeMissingResourcePath:
                  summary: Attribute type missing resourcePath
                  value:
                    error: "Validation failed"
                    message: "attribute validation failed: resourcePath is required for attribute type"
                    type: "attribute_validation_error"
                duplicateName:
                  summary: Name already exists in organization
                  value:
                    code: "INVALID_REQUEST"
                    message: "Invalid request"
                    details: "purpose name 'readAccountBasic' already exists for this organization"
        "404":
          description: Consent purpose not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
        - basicAuth: []
    delete:
      summary: Delete a consent purpose
      description: |
        Deletes a consent purpose. The purpose must exist and belong to the specified organization.
        
        **Note:** This operation will not delete any mappings if the purpose is currently linked to consents. 
        The CASCADE DELETE in the database schema will handle cleanup of purpose-consent mappings automatically 
        when a consent is deleted.
      operationId: deleteConsentPurpose
      tags:
        - Consent Purpose
      parameters:
        - in: header
          name: org-id
          required: true
          description: The unique identifier for the organization
          schema:
            type: string
            example: "ORG-123"
        - name: purposeId
          in: path
          required: true
          description: The unique identifier of the consent purpose to delete
          schema:
            type: string
            example: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      responses:
        "204":
          description: Successfully deleted consent purpose (no content returned)
        "404":
          description: Consent purpose not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
        - basicAuth: []
  /consents/validate:
    post:
      summary: Validate a consent for a specific action
      description: |
        Validates whether a consent is valid and active for a specific user action or API request.
        
        This endpoint checks:
        - If the consent exists and belongs to the specified user
        - If the consent status is active (AUTHORIZED, ACTIVE, etc.)
        - If the consent has not expired based on validityTime
        - Optionally validates resource parameters against consent scope
        
        If the consent has expired, the endpoint automatically updates the consent status to EXPIRED.
        
        **Note:** All responses return HTTP 200. Check the `isValid` field and `httpCode` in the response body to determine the actual validation result.
      operationId: consents-validate-POST
      tags:
        - Consent
      parameters:
        - in: header
          name: org-id
          required: true
          description: "The unique identifier for the organization."
          schema:
            type: string
        - in: header
          name: client-id
          required: true
          description: "The client ID of the application making the validation request."
          schema:
            type: string
      requestBody:
        description: The validation request containing consent details and the action being validated.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ValidateRequest"
      responses:
        "200":
          description: |
            Validation completed. Check the `isValid` field in the response body.
            - If `isValid: true`, the consent is valid for the requested action
            - If `isValid: false`, check `errorCode`, `errorMessage`, and `httpCode` for details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidateResponse"
      security:
        - basicAuth: []
components:
  schemas:
    File:
      type: object
      description: Represents a file to be uploaded or downloaded.
      additionalProperties: false
      properties: {}
    AuthorizationResourceRequestBody:
      type: object
      description: Payload for creating or updating an authorization resource.
      required:
        - type
        - status
      properties:
        userId:
          description: The unique ID of the user who performed this authorization.
          type: string
          example: "admin@carbon.super"
        type:
          description: The type of authorization (e.g., 'authorisation', 're-authorisation').
          type: string
          example: "authorisation"
        status:
          description: The current status of this specific authorization (e.g., 'created', 'authorised', 'rejected').
          type: string
          example: "created"
        approvedPurposeDetails:
          description: Details of approved purposes and additional resources for this authorization.
          type: object
          properties:
            approvedPurposesNames:
              description: Array of approved consent purpose names.
              type: array
              items:
                type: string
              example: ["utility_read", "taxes_read"]
            approvedAdditionalResources:
              description: Array of additional approved resources (flexible structure).
              type: array
              items:
                type: object
              example: []
    ConsentRevokePayload:
      type: object
      description: The request body for revoking a consent.
      required:
        - actionBy
      properties:
        actionBy:
          description: Identifier of the user or system performing the revoke action.
          type: string
          example: "admin@wso2.com"
        revocationReason:
          description: The reason for revoking the consent.
          type: string
          example: "Admin revoke"
    ConsentCreatePayload:
      type: object
      description: The request body for initiating a new consent.
      properties:
        type:
          description: The type of consent (e.g., 'accounts', 'payments').
          type: string
          example: "accounts"
        status:
          description: The current status of the consent in its lifecycle (e.g., 'AwaitingAuthorisation', 'authorised', 'revoked', 'expired').
          type: string
          example: "AwaitingAuthorisation"
        validityTime:
          description: The duration for which the consent is valid, in seconds. '0' may indicate it does not expire automatically.
          type: integer
          format: int64
          example: 0
        recurringIndicator:
          description: A boolean flag indicating if the consent is for a recurring payment or access.
          type: boolean
          example: false
        dataAccessValidityDuration:
          description: The duration for which data access is valid, in seconds. Optional field that specifies how long the consent allows access to user data.
          type: integer
          format: int64
          example: 86400
        frequency:
          description: For recurring consents, this indicates the frequency (e.g., per day). '0' may indicate no limit.
          type: integer
          format: int32
          example: 0
        consentPurpose:
          description: Array of consent purposes for this consent.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Purpose name
                example: "utility_read"
              value:
                description: Purpose value
                oneOf:
                  - type: string
                  - type: object
                  - type: array
                example: "utility:read"
        attributes:
          description: A key-value map of additional, non-standard attributes associated with the consent.
          type: object
          properties:
            key:
              type: string
        authorizations:
          description: An array of authorization resources linked to this consent, detailing which users have acted upon it.
          type: array
          items:
            $ref: "#/components/schemas/ConsentAuthorizationCreatePayload"
    ConsentAuthorizationCreatePayload:
      type: object
      description: Represents a detaild authorization object.
      properties:
        userId:
          description: The unique ID of the user who performed this authorization.
          type: string
          example: "admin@carbon.super"
        type:
          description: The type of authorization (e.g., 'authorisation', 're-authorisation').
          type: string
          example: "authorisation"
        status:
          description: The current status of this specific authorization (e.g., 'created', 'authorised', 'rejected').
          type: string
          example: "created"
        approvedPurposeDetails:
          description: Details of approved purposes and additional resources for this authorization.
          type: object
          properties:
            approvedPurposesNames:
              description: Array of approved consent purpose names.
              type: array
              items:
                type: string
              example: ["utility_read", "taxes_read"]
            approvedAdditionalResources:
              description: Array of additional approved resources (flexible structure).
              type: array
              items:
                type: object
              example: []
    ConsentAuthorizationCreateResponse:
      type: object
      description: Represents a detaild authorization object.
      properties:
        id:
          description: Auth Id
          type: string
          example: "auth_id"
        userId:
          description: The unique ID of the user who performed this authorization.
          type: string
          example: "admin@carbon.super"
        type:
          description: The type of authorization (e.g., 'authorisation', 're-authorisation').
          type: string
          example: "authorisation"
        status:
          description: The current status of this specific authorization (e.g., 'created', 'authorised', 'rejected').
          type: string
          example: "created"
        updatedTime:
          type: integer
          format: int32
        approvedPurposeDetails:
          description: Details of approved purposes and additional resources for this authorization.
          type: object
          properties:
            approvedPurposesNames:
              description: Array of approved consent purpose names.
              type: array
              items:
                type: string
              example: ["utility_read", "taxes_read"]
            approvedAdditionalResources:
              description: Array of additional approved resources (flexible structure).
              type: array
              items:
                type: object
              example: []
    ConsentErrorCommon:
      type: object
      description: A standardized error response object.
      properties:
        code:
          description: Error code.
          type: string
        message:
          description: A short, human-readable summary of the problem.
          type: string
        description:
          description: A detailed explanation of the error.
          type: string
        traceId:
          description: TraceId
          type: string        
    ConsentSearchResponse:
      type: object
      description: The response from a successful consent search query.
      properties:
        data:
          description: An array of detailed consent objects matching the search criteria.
          type: array
          items:
            $ref: "#/components/schemas/ConsentDetail"
        meatadata:
          $ref: "#/components/schemas/ConsentSearchMetadata"
    ConsentUpdateRequest:
      type: object
      description: A generic success response for consent management operations that return consent details.
      properties:
        type:
          description: The type of consent (e.g., 'accounts', 'payments').
          type: string
          example: "accounts"
        status:
          description: The current status of the consent in its lifecycle (e.g., 'AwaitingAuthorisation', 'authorised', 'revoked', 'expired').
          type: string
          example: "AwaitingAuthorisation"
        validityTime:
          description: The duration for which the consent is valid, in seconds. '0' may indicate it does not expire automatically.
          type: integer
          format: int64
          example: 0
        recurringIndicator:
          description: A boolean flag indicating if the consent is for a recurring payment or access.
          type: boolean
          example: false
        dataAccessValidityDuration:
          description: The duration for which data access is valid, in seconds. Optional field that specifies how long the consent allows access to user data.
          type: integer
          format: int64
          example: 86400
        frequency:
          description: For recurring consents, this indicates the frequency (e.g., per day). '0' may indicate no limit.
          type: integer
          format: int32
          example: 0
        consentPurpose:
          description: Array of consent purposes for this consent.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Purpose name
                example: "utility_read"
              value:
                description: Purpose value
                oneOf:
                  - type: string
                  - type: object
                  - type: array
                example: "utility:read"
        attributes:
          description: A key-value map of additional, non-standard attributes associated with the consent.
          type: object
          properties:
            key:
              type: string
        authorizations:
          description: An array of authorization resources linked to this consent, detailing which users have acted upon it.
          type: array
          items:
            $ref: "#/components/schemas/ConsentAuthorizationCreatePayload"
    ConsentUpdateResponse:
      type: object
      description: A generic success response for consent management operations that return consent details.
      properties:
        id:
          description: Consent Id
          type: string
          example: "consent_id"
        consentPurpose:
          description: Array of consent purposes for this consent.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Purpose name
                example: "utility_read"
              value:
                description: Purpose value
                oneOf:
                  - type: string
                  - type: object
                  - type: array
                example: "utility:read"
        createdTime:
          type: integer
          format: int32
        updatedTime:
          type: integer
          format: int32
        clientId:
          type: string
        type:
          description: The type of consent (e.g., 'accounts', 'payments').
          type: string
          example: "accounts"
        status:
          description: The current status of the consent in its lifecycle (e.g., 'AwaitingAuthorisation', 'authorised', 'revoked', 'expired').
          type: string
          example: "AwaitingAuthorisation"
        frequency:
          description: For recurring consents, this indicates the frequency (e.g., per day). '0' may indicate no limit.
          type: integer
          format: int32
          example: 0
        validityTime:
          description: The duration for which the consent is valid, in seconds. '0' may indicate it does not expire automatically.
          type: integer
          format: int64
          example: 0
        recurringIndicator:
          description: A boolean flag indicating if the consent is for a recurring payment or access.
          type: boolean
          example: false
        dataAccessValidityDuration:
          description: The duration for which data access is valid, in seconds. Optional field that specifies how long the consent allows access to user data.
          type: integer
          format: int64
          example: 86400
        attributes:
          description: A key-value map of additional, non-standard attributes associated with the consent.
          type: object
          properties:
            key:
              type: string
        authorizations:
          description: An array of authorization resources linked to this consent, detailing which users have acted upon it.
          type: array
          items:
            $ref: "#/components/schemas/ConsentAuthorizationCreateResponse"
        modifiedResponse:
          description: Optional field used to provide an alternative payload that overrides the original `consentPurpose` during consent processing.
          type: object
    ConsentRetrievalResponse:
      description: The response body returned after successfully initiating a new consent.
      properties:
        id:
          description: Consent Id
          type: string
          example: "consent_id"
        consentPurpose:
          description: Array of consent purposes for this consent.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Purpose name
                example: "utility_read"
              value:
                description: Purpose value
                oneOf:
                  - type: string
                  - type: object
                  - type: array
                example: "utility:read"
        createdTime:
          type: integer
          format: int32
        updatedTime:
          type: integer
          format: int32
        clientId:
          type: string
        type:
          description: The type of consent (e.g., 'accounts', 'payments').
          type: string
          example: "accounts"
        status:
          description: The current status of the consent in its lifecycle (e.g., 'AwaitingAuthorisation', 'authorised', 'revoked', 'expired').
          type: string
          example: "AwaitingAuthorisation"
        frequency:
          description: For recurring consents, this indicates the frequency (e.g., per day). '0' may indicate no limit.
          type: integer
          format: int32
          example: 0
        validityTime:
          description: The duration for which the consent is valid, in seconds. '0' may indicate it does not expire automatically.
          type: integer
          format: int64
          example: 0
        recurringIndicator:
          description: A boolean flag indicating if the consent is for a recurring payment or access.
          type: boolean
          example: false
        dataAccessValidityDuration:
          description: The duration for which data access is valid, in seconds. Optional field that specifies how long the consent allows access to user data.
          type: integer
          format: int64
          example: 86400

        attributes:
          description: A key-value map of additional, non-standard attributes associated with the consent.
          type: object
          properties:
            key:
              type: string
        authorizations:
          description: An array of authorization resources linked to this consent, detailing which users have acted upon it.
          type: array
          items:
            $ref: "#/components/schemas/ConsentAuthorizationCreateResponse"
        fileContent:
          description: File content
          type: string
        modifiedResponse:
          description: Optional field used to provide an alternative payload that overrides the original `consentPurpose` during consent processing.
          type: object
    ConsentFileUploadResponse:
      type: object
      description: The response body returned after successfully uploading a file for a consent.
      properties:
        modifiedResponse:
          description: Optional field used to provide an alternative payload that overrides the response paylaod.
    ConsentFileUpdateResponse:
      type: object
      description: The response body returned after successfully updating a file for the consent.
      properties:
        modifiedResponse:
          description: Optional field used to provide an alternative payload that overrides the response paylaod.
    ConsentRevokedResponse:
      type: object
      description: The response body returned after successfully revoking a consent.
      properties:
        actionTime:
          description: The Unix timestamp (in seconds) when the revocation occurred.
          type: integer
          format: int64
          example: 1758829540
        actionBy:
          description: The user or system that performed the revoke action.
          type: string
          example: "admin@wso2.com"
        revocationReason:
          description: The reason provided for revoking the consent.
          type: string
          example: "Admin revoke"
    ConsentCreatedResponse:
      type: object
      description: The response body returned after successfully initiating a new consent.
      properties:
        id:
          description: Consent Id
          type: string
          example: "consent_id"
        consentPurpose:
          description: Array of consent purposes for this consent.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Purpose name
                example: "utility_read"
              value:
                description: Purpose value
                oneOf:
                  - type: string
                  - type: object
                  - type: array
                example: "utility:read"
        createdTime:
          type: integer
          format: int32
        updatedTime:
          type: integer
          format: int32
        clientId:
          type: string
        type:
          description: The type of consent (e.g., 'accounts', 'payments').
          type: string
          example: "accounts"
        status:
          description: The current status of the consent in its lifecycle (e.g., 'AwaitingAuthorisation', 'authorised', 'revoked', 'expired').
          type: string
          example: "AwaitingAuthorisation"
        frequency:
          description: For recurring consents, this indicates the frequency (e.g., per day). '0' may indicate no limit.
          type: integer
          format: int32
          example: 0
        validityTime:
          description: The duration for which the consent is valid, in seconds. '0' may indicate it does not expire automatically.
          type: integer
          format: int64
          example: 0
        recurringIndicator:
          description: A boolean flag indicating if the consent is for a recurring payment or access.
          type: boolean
          example: false
        dataAccessValidityDuration:
          description: The duration for which data access is valid, in seconds. Optional field that specifies how long the consent allows access to user data.
          type: integer
          format: int64
          example: 86400
        attributes:
          description: A key-value map of additional, non-standard attributes associated with the consent.
          type: object
          properties:
            key:
              type: string
        authorizations:
          description: An array of authorization resources linked to this consent, detailing which users have acted upon it.
          type: array
          items:
            $ref: "#/components/schemas/ConsentAuthorizationCreateResponse"
        modifiedResponse:
          description: Optional field used to provide an alternative payload that overrides the original `consentPurpose` during consent processing.
          type: object
    ConsentDetail:
      type: object
      description: A comprehensive object representing a single consent and all its associated data.
      properties:
        id:
          description: Consent Id
          type: string
          example: "consent_id"
        consentPurpose:
          description: Array of consent purposes for this consent.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Purpose name
                example: "utility_read"
              value:
                description: Purpose value
                oneOf:
                  - type: string
                  - type: object
                  - type: array
                example: "utility:read"
        createdTime:
          type: integer
          format: int32
        updatedTime:
          type: integer
          format: int32
        clientId:
          type: string
        type:
          description: The type of consent (e.g., 'accounts', 'payments').
          type: string
          example: "accounts"
        status:
          description: The current status of the consent in its lifecycle (e.g., 'AwaitingAuthorisation', 'authorised', 'revoked', 'expired').
          type: string
          example: "AwaitingAuthorisation"
        frequency:
          description: For recurring consents, this indicates the frequency (e.g., per day). '0' may indicate no limit.
          type: integer
          format: int32
          example: 0
        validityTime:
          description: The duration for which the consent is valid, in seconds. '0' may indicate it does not expire automatically.
          type: integer
          format: int64
          example: 0
        recurringIndicator:
          description: A boolean flag indicating if the consent is for a recurring payment or access.
          type: boolean
          example: false
        dataAccessValidityDuration:
          description: The duration for which data access is valid, in seconds. Optional field that specifies how long the consent allows access to user data.
          type: integer
          format: int64
          example: 86400
        attributes:
          description: A key-value map of additional, non-standard attributes associated with the consent.
          type: object
          properties:
            key:
              type: string
        authorizations:
          description: An array of authorization resources linked to this consent, detailing which users have acted upon it.
          type: array
          items:
            $ref: "#/components/schemas/ConsentAuthorizationCreateResponse"
        fileContent:
          description: File content
          type: string
    ConsentSearchMetadata:
      type: object
      description: Pagination metadata returned with search results.
      properties:
        total:
          description: The total number of results available for the query, ignoring pagination.
          type: integer
        offset:
          description: The starting position of the returned result set.
          type: integer
        count:
          description: The number of results included in the current response.
          type: integer
        limit:
          description: The maximum number of results requested per page.
          type: integer
    ConsentAuthorizationResource:
      type: object
      description: Represents a specific authorization action taken on a consent by a user.
      properties:
        id:
          description: Auth Id
          type: string
          example: "auth_id"
        userId:
          description: The unique ID of the user who performed this authorization.
          type: string
          example: "admin@carbon.super"
        type:
          description: The type of authorization (e.g., 'authorisation', 're-authorisation').
          type: string
          example: "authorisation"
        status:
          description: The current status of this specific authorization (e.g., 'created', 'authorised', 'rejected').
          type: string
          example: "created"
        updatedTime:
          type: integer
          format: int32
        approvedPurposeDetails:
          description: Details of approved purposes and additional resources for this authorization.
          type: object
          properties:
            approvedPurposesNames:
              description: Array of approved consent purpose names.
              type: array
              items:
                type: string
              example: ["utility_read", "taxes_read"]
            approvedAdditionalResources:
              description: Array of additional approved resources (flexible structure).
              type: array
              items:
                type: object
              example: []
    ValidateRequest:
      type: object
      description: Request payload for validating a consent for a specific action.
      required:
        - consentId
        - userId
        - resourceParams
      properties:
        consentId:
          description: The unique identifier of the consent to validate.
          type: string
          example: "CNT_123456"
        userId:
          description: The unique identifier of the user performing the action.
          type: string
          example: "user123"
        clientId:
          description: The client ID of the application making the request.
          type: string
          example: "banking-app-001"
        headers:
          description: Optional headers from the actual API request being validated.
          type: object
          additionalProperties:
            type: string
          example:
            Authorization: "Bearer token123"
            x-request-id: "req-456"
        payload:
          description: Optional payload from the actual API request being validated.
          type: object
          example:
            accountId: "ACC-789"
            fromDate: "2025-01-01"
            toDate: "2025-10-26"
        electedResource:
          description: The resource the user is trying to access.
          type: string
          example: "account-transactions"
        resourceParams:
          description: Parameters describing the specific action being validated.
          type: object
          required:
            - resource
            - httpMethod
          properties:
            resource:
              description: The API resource path being accessed.
              type: string
              example: "/accounts/ACC-789/transactions"
            httpMethod:
              description: The HTTP method of the request.
              type: string
              example: "GET"
            context:
              description: Additional context about the request.
              type: string
              example: "transaction-history"
    ValidateResponse:
      type: object
      description: Response payload from consent validation.
      properties:
        isValid:
          description: Whether the consent is valid for the requested action.
          type: boolean
          example: true
        modifiedPayload:
          description: Optional modified payload if the consent requires transformation of the request.
          type: object
          nullable: true
        errorCode:
          description: Error code if validation failed (e.g., "Unauthorized", "Expired", "NotFound").
          type: string
          example: "Unauthorized"
        errorMessage:
          description: Human-readable error message if validation failed.
          type: string
          example: "Consent validation failed"
    ConsentIdsResponse:
      type: object
      description: Response payload containing consent IDs matching the attribute search criteria.
      properties:
        consentIds:
          description: Array of consent IDs that match the search criteria, sorted alphabetically.
          type: array
          items:
            type: string
          example: ["CNT_001", "CNT_002", "CNT_003"]
        count:
          description: The number of consent IDs returned.
          type: integer
          example: 3
    ConsentAttributeSearchResponse:
      $ref: "#/components/schemas/ConsentIdsResponse"
    ConsentPurposeCreateRequest:
      type: object
      required:
        - name
        - type
        - attributes
      description: |
        Request object for creating a consent purpose. All fields marked as required must be provided.
        
        **Type Handler Architecture:**
        Each purpose type has specific attribute requirements:
        - **string**: No mandatory attributes (any attributes are optional)
        - **json-schema**: Requires `validationSchema` attribute
        - **attribute**: Requires both `resourcePath` and `jsonPath` attributes
        
        **Batch Creation:**
        When creating multiple purposes in a batch:
        - Each purpose name must be unique within the batch
        - Each purpose name must not already exist in the organization
        - If any validation fails, the entire batch is rolled back (atomic operation)
      properties:
        name:
          type: string
          maxLength: 255
          description: |
            The name/identifier of the consent purpose. Must be unique within the organization.
            Database constraint: UNIQUE KEY unique_name_per_org (NAME, ORG_ID)
            Batch constraint: Must be unique within the batch request
          example: "license_read"
        description:
          type: string
          maxLength: 1024
          description: Optional description providing additional context about the purpose
          example: "Allows accessing license API"
        type:
          type: string
          enum:
            - string
            - json-schema
            - attribute
          description: |
            The type of the purpose determines which attributes are mandatory:
            - 'string': No mandatory attributes (any attributes are optional)
            - 'json-schema': Requires `validationSchema` attribute
            - 'attribute': Requires `resourcePath` and `jsonPath` attributes
          example: "string"
        attributes:
          type: object
          additionalProperties:
            type: string
          description: |
            Key-value map of attributes. Required attributes depend on the type:
            - **string type**: No mandatory attributes. Can have any attributes (e.g., value: "license:read")
            - **json-schema type**: Must have `validationSchema` attribute containing JSON schema
            - **attribute type**: Must have `resourcePath` and `jsonPath`, optionally `validationSchema`
          example:
            value: "license:read"
    ConsentPurposeUpdateRequest:
      type: object
      required:
        - name
        - type
        - attributes
      properties:
        name:
          type: string
          maxLength: 255
          description: Name for the consent purpose (required, must be unique within organization)
          example: "license_read_v2"
        description:
          type: string
          maxLength: 1024
          description: Description for the consent purpose (optional)
          example: "Updated description for license API access"
        type:
          type: string
          enum:
            - string
            - json-schema
            - attribute
          description: |
            Type of the consent purpose (required). Determines mandatory attributes:
            - 'string': No mandatory attributes
            - 'json-schema': Requires `validationSchema` attribute
            - 'attribute': Requires `resourcePath` and `jsonPath` attributes
          example: "string"
        attributes:
          type: object
          additionalProperties:
            type: string
          description: |
            Key-value map of attributes (required). Required attributes depend on type:
            - **string type**: No mandatory attributes
            - **json-schema type**: Must have `validationSchema` attribute
            - **attribute type**: Must have `resourcePath` and `jsonPath` attributes
          example:
            value: "license:read:v2"
      description: All fields except description are required - partial updates are not supported
    ConsentPurposeResponse:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the consent purpose (UUID with PURPOSE- prefix)
          example: "PURPOSE-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        name:
          type: string
          description: The name/identifier of the consent purpose
          example: "license_read"
        description:
          type: string
          description: Description of the consent purpose
          example: "Allows accessing license API"
        type:
          type: string
          enum:
            - string
            - json-schema
            - attribute
          description: |
            The type of the purpose. Determines which attributes are mandatory:
            - 'string': No mandatory attributes
            - 'json-schema': Requires `validationSchema` attribute
            - 'attribute': Requires `resourcePath` and `jsonPath` attributes
          example: "string"
        attributes:
          type: object
          additionalProperties:
            type: string
          description: |
            Key-value map of attributes. Content depends on the purpose type:
            - **string type**: Can have any attributes (e.g., value: "license:read")
            - **json-schema type**: Must have `validationSchema` attribute
            - **attribute type**: Must have `resourcePath` and `jsonPath` attributes
          example:
            value: "license:read"
      required:
        - id
        - name
        - type
        - attributes
    ConsentPurposeListResponse:
      type: object
      properties:
        purposes:
          type: array
          description: Array of consent purposes
          items:
            $ref: "#/components/schemas/ConsentPurposeResponse"
        total:
          type: integer
          description: Total number of purposes available (for pagination)
          example: 25
      required:
        - purposes
        - total
    ErrorResponse:
      type: object
      properties:
        code:
          type: string
          description: Error code identifying the type of error
          enum:
            - BAD_REQUEST
            - UNAUTHORIZED
            - FORBIDDEN
            - NOT_FOUND
            - INTERNAL_SERVER_ERROR
          example: "BAD_REQUEST"
        message:
          type: string
          description: Human-readable error message
          example: "Invalid request body"
        details:
          type: string
          description: Additional details about the error
          example: "Key: 'ConsentPurposeCreateRequest.Name' Error:Field validation for 'Name' failed on the 'required' tag"
      required:
        - code
        - message
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
      description: Basic Authentication using username and password.